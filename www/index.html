<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Web Status</title>
  <!-- Bootstrap CSS (CDN) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css">
  <!-- Custom tweaks -->
  <link rel="stylesheet" href="/css/custom.css">
    <style>
  body { padding: 20px; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; }
  .tab-pane { display: none; }
  .tab-pane.active { display: block; }
  pre { background:#f8f8f8; padding:10px; border:1px solid #ddd; }
  .small-muted { font-size:90%; color:#666; }
  .dl-horizontal dt { width:200px; }
  .page-header h1 { margin-bottom:6px; }
  .table-condensed th, .table-condensed td { padding:6px; }
  .table-hover > tbody > tr:hover { background-color:#f5f5f5; }
  /* Shared spinner used by refresh buttons */
  .spin{display:inline-block; width:12px; height:12px; vertical-align:middle; margin-right:6px;}
  @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  .spin.rotate { animation: spin 1s linear infinite; }
  /* Fetch stats badges */
  .fetch-badge { display:inline-block; padding:5px 10px; margin-right:6px; border-radius:6px; background:#f0f6ff; color:#013369; font-size:90%; border:1px solid #c9deff; }
  .fetch-badge.warn { background:#fff6e5; color:#6a4a00; border-color:#ffe9b8; }
  .fetch-badge.crit { background:#ffecec; color:#6a0000; border-color:#ffb8b8; }
  /* Nav host styling */
  #nav-host { font-weight:600; }
  #nav-host .glyphicon { vertical-align:middle; margin-right:6px; }
  #nav-host #hostname { color: #013369; margin-left:4px; }
  /* Responsive: hide hostname text on narrow viewports to avoid wrapping */
  @media (max-width: 600px) {
    #nav-host #hostname { display:none; }
    #nav-host { padding-right:6px; }
  }
  /* blink animation for critical indicator */
  @keyframes fetchPulse { 0% { box-shadow: 0 0 0 rgba(185,74,72,0.0); } 50% { box-shadow: 0 0 12px rgba(185,74,72,0.55); } 100% { box-shadow: 0 0 0 rgba(185,74,72,0.0); } }
  .fetch-crit-blink { animation: fetchPulse 1.2s ease-in-out infinite; }
    </style>
  </head>
  <body>
    <div class="container layout-root">
      <header class="site-header clearfix">
        <div class="brand">
          <h3 style="margin:0">Web Status <small id="main-host">&nbsp;</small></h3>
        </div>
        <div class="header-actions">
          <div id="nav-host"><span id="hostname">hostname.nodename.wien.funkfeuer.at</span></div>
        </div>
      </header>

      <div class="row">
        <aside class="col-sm-3 sidebar">
          <ul id="mainTabs" class="nav nav-pills nav-stacked">
            <li role="presentation"><a href="#tab-main"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> Übersicht</a></li>
            <li role="presentation" class="active"><a href="#tab-status"><span class="glyphicon glyphicon-dashboard" aria-hidden="true"></span> Status</a></li>
            <li role="presentation"><a href="#tab-olsr"><span class="glyphicon glyphicon-random" aria-hidden="true"></span> OLSR Links</a></li>
            <li role="presentation"><a href="#tab-fetch"><span class="glyphicon glyphicon-time" aria-hidden="true"></span> Fetch Queue</a></li>
            <li role="presentation" id="tab-olsrd2-links" style="display:none"><a href="#tab-neighbors"><span class="glyphicon glyphicon-link" aria-hidden="true"></span> OLSRd2-Links</a></li>
            <li role="presentation"><a href="#tab-connections"><span class="glyphicon glyphicon-transfer" aria-hidden="true"></span> Connections</a></li>
            <li role="presentation"><a href="#tab-versions"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span> Versions</a></li>
            <li role="presentation"><a href="#tab-traceroute"><span class="glyphicon glyphicon-road" aria-hidden="true"></span> Traceroute</a></li>
            <li role="presentation" id="tab-olsr2-link" style="display:none"><a href="#tab-olsr2"><span class="glyphicon glyphicon-dashboard" aria-hidden="true"></span> OLSRv2</a></li>
            <li role="presentation"><a href="#tab-contact"><span class="glyphicon glyphicon-user" aria-hidden="true"></span> Kontakt</a></li>
            <li role="presentation" id="tab-admin-link" style="display:none"><a href="#tab-admin"><span class="glyphicon glyphicon-lock" aria-hidden="true"></span> Admin</a></li>
          </ul>
        </aside>

        <main class="col-sm-9 content" style="margin-top:8px;">
          <div class="tab-content" style="margin-top:0">
        <!-- Status -->
        <div id="tab-status" class="tab-pane active">
          <div id="status-card" class="panel panel-default" style="padding:10px; margin-bottom:10px;">
            <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
              <div>
                <div style="font-weight:700"><span id="hostname">-</span></div>
                <div class="small-muted" id="host-ip">-</div>
              </div>
              <div style="text-align:right">
                <div>Uptime: <span id="uptime">-</span></div>
                <div>Links: <span id="olsr-links-count">-</span></div>
              </div>
            </div>
          </div>
          <dl class="dl-horizontal">
            <dt>System Uptime <span class="glyphicon glyphicon-time" aria-hidden="true"></span></dt>
            <dd><span id="dl-uptime">-</span></dd>
            <dt>Last Updated <span class="glyphicon glyphicon-time" aria-hidden="true"></span></dt>
            <dd><span id="last-updated">-</span></dd>
            <dt>IPv4 Default-Route <span class="glyphicon glyphicon-transfer" aria-hidden="true"></span></dt>
            <dd><span id="dl-default-route"><span id="default-route">n/a</span></span></dd>
            <dt>mgmt Devices <span class="glyphicon glyphicon-signal" aria-hidden="true"></span></dt>
            <dd>&nbsp;</dd>
          </dl>
          <div class="table-search-container"><input class="table-search-input form-control input-sm" data-target="#devicesTable" placeholder="Search..."></div>
          <div class="table-responsive">
            <table id="devicesTable" class="table table-hover table-bordered table-condensed">
              <thead>
                <tr>
                  <th data-key="ipv4">Local (IP / HW)</th>
                  <th data-key="hostname">Hostname</th>
                  <th data-key="product">Product</th>
                  <th data-key="uptime">Uptime</th>
                  <th data-key="mode">Mode</th>
                  <th data-key="essid">ESSID</th>
                  <th data-key="firmware">Firmware</th>
                  <th data-key="signal">Signal</th>
                  <th data-key="tx_rate">Tx Rate</th>
                  <th data-key="rx_rate">Rx Rate</th>
                  <th data-key="wireless">Wireless</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Fetch Queue -->
        <div id="tab-fetch" class="tab-pane">
          <h3>Fetch Queue</h3>
          <div id="fetch-tab-wrap"></div>
        </div>

        <!-- Main / Willkommen -->
        <div id="tab-main" class="tab-pane">
          <div class="page-header">
            <h1>Willkommen auf <span id="main-host"> </span></h1>
          </div>
          <div class="panel panel-default">
            <div class="panel-body"><b>WAS?</b></div>
            <div class="panel-footer">FunkFeuer ist ein freies, experimentelles Netzwerk in Wien, Graz, der Weststeiermark, in Teilen des Weinviertels (N&Ouml;) und in Bad Ischl. Es wird aufgebaut und betrieben von computerbegeisterten Menschen. Das Projekt verfolgt keine kommerziellen Interessen.</div>
          </div>
          <div class="panel panel-default">
            <div class="panel-body"><b>FREI?</b></div>
            <div class="panel-footer">FunkFeuer ist offen f&uuml;r jeden und jede, der/die Interesse hat und bereit ist mitzuarbeiten. Es soll dabei ein nicht reguliertes Netzwerk entstehen, welches das Potential hat, den digitalen Graben zwischen den sozialen Schichten zu &Uuml;berbr&uuml;cken und so Infrastruktur und Wissen zur Verf&uuml;gung zu stellen. Zur Teilnahme an FunkFeuer braucht man einen WLAN Router (gibt's ab 60 Euro) oder einen PC, das OLSR Programm, eine IP Adresse von FunkFeuer, etwas Geduld und Motivation. Auf unserer Karte ist eingezeichnet, wo man FunkFeuer schon &Uuml;berall (ungef&auml;r) empfangen kann (bitte beachte, dass manchmal H&auml;user oder &Auml;hnliches im Weg sind, dann geht's nur &uuml;ber Umwege).</div>
          </div>
        </div>

        <!-- Contact -->
        <div id="tab-contact" class="tab-pane">
          <h3>Kontakt</h3>
          <p>Kontaktinformationen...</p>
        </div>

        <!-- OLSR Links -->
  <div id="tab-olsr" class="tab-pane">
      <h3>OLSR Links <button id="refresh-links" class="btn btn-xs btn-default"><span class="spin" id="refresh-links-spinner"></span>Refresh</button>
            <span id="links-status" class="small-muted"></span></h3>
          <div class="table-search-container"><input class="table-search-input form-control input-sm" data-target="#olsrLinksTable" placeholder="Search..."></div>
          <div class="table-responsive">
            <table id="olsrLinksTable" class="table table-bordered table-condensed">
              <thead>
                <tr>
                  <th data-key="intf">Intf</th>
                  <th data-key="local">Local</th>
                  <th data-key="remote">Remote</th>
                  <th data-key="remote_host">Remote Host</th>
                  <th data-key="remote_node">Node</th>
                  <th data-key="lq">LQ</th>
                  <th data-key="nlq">NLQ</th>
                  <th data-key="cost">Cost</th>
                  <th data-key="routes">Routes</th>
                  <th data-key="nodes">Nodes</th>
                  <th data-key="actions">Actions</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Neighbors -->
        <div id="tab-neighbors" class="tab-pane">
          <h3>Neighbors</h3>
          <div class="table-search-container"><input class="table-search-input form-control input-sm" data-target="#neighborsTable" placeholder="Search..."></div>
          <div class="table-responsive">
            <table id="neighborsTable" class="table table-bordered table-condensed">
              <thead>
                <tr>
                  <th>Originator</th>
                  <th>Hostname</th>
                  <th>BindTo</th>
                  <th>LQ</th>
                  <th>NLQ</th>
                  <th>Cost</th>
                  <th>Metric</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Connections -->
        <div id="tab-connections" class="tab-pane">
          <h3>Connections <button id="refresh-connections" class="btn btn-xs btn-default"><span class="spin" id="refresh-connections-spinner"></span>Refresh</button>
            <span id="connections-status" class="small-muted"></span></h3>
          <div class="table-search-container"><input class="table-search-input form-control input-sm" data-target="#connectionsTable" placeholder="Search..."></div>
          <div class="table-responsive">
            <table id="connectionsTable" class="table table-condensed table-striped">
              <thead>
                <tr>
                  <th data-key="port">Port</th>
                  <th data-key="bridge">Bridge</th>
                  <th data-key="macs">MACs</th>
                  <th data-key="ips">IPs</th>
                  <th data-key="hostname">Hostname</th>
                  <th data-key="node">Node</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Simple Modal for Route Details -->
        <div id="route-modal" class="modal-overlay" aria-hidden="true">
          <div class="modal-panel">
            <div style="display:flex; flex-wrap:wrap; gap:10px; justify-content:space-between; align-items:center; margin-bottom:10px;">
              <div style="display:flex; align-items:center; gap:12px;">
                <h4 id="route-modal-title" style="margin:0; font-weight:600;">Routes</h4>
                <span id="route-modal-count" class="label label-primary" style="display:none"></span>
              </div>
              <div style="display:flex; gap:6px; flex-wrap:wrap; align-items:center;">
                <input id="route-filter" type="text" class="form-control input-sm" placeholder="Filter (prefix, dev, metric)" style="width:220px;">
                <button id="route-copy" type="button" class="btn btn-xs btn-default" title="Copy visible routes"><span class="glyphicon glyphicon-copy" aria-hidden="true"></span></button>
                <button id="route-modal-close" type="button" class="btn btn-xs btn-default">Close</button>
              </div>
            </div>
            <div style="border:1px solid #ddd; border-radius:4px; max-height:420px; overflow:auto;">
              <table id="route-modal-table" class="table table-condensed table-striped" style="margin:0; font-size:12px;">
                <thead style="position:sticky; top:0; background:#fafafa;">
                  <tr>
                    <th style="width:45%; cursor:pointer;" data-key="destination">Destination <span class="glyphicon glyphicon-sort" aria-hidden="true"></span></th>
                    <th style="width:20%; cursor:pointer;" data-key="device">Device <span class="glyphicon glyphicon-sort" aria-hidden="true"></span></th>
                    <th style="width:15%; cursor:pointer;" data-key="metric">Metric <span class="glyphicon glyphicon-sort" aria-hidden="true"></span></th>
                    <th style="width:20%;">Raw</th>
                  </tr>
                </thead>
                <tbody id="route-modal-tbody"><tr><td colspan="4" class="text-muted">Loading...</td></tr></tbody>
              </table>
            </div>
            <div style="margin-top:8px; font-size:11px; color:#666; display:flex; justify-content:space-between; flex-wrap:wrap; gap:8px;">
              <div>Click a column header to sort (coming soon) • Filter supports simple substring match.</div>
              <div></div>
            </div>
            <pre id="route-modal-body" style="display:none; margin-top:10px; font-family:monospace; font-size:11px; max-height:320px; overflow:auto; background:#fcfcfc; border:1px solid #eee; padding:8px;"></pre>
          </div>
        </div>

          <!-- Simple Modal for Node Details -->
          <div id="node-modal" class="modal-overlay" aria-hidden="true">
            <div class="modal-panel">
              <div style="display:flex; flex-wrap:wrap; gap:10px; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <div style="display:flex; align-items:center; gap:12px;">
                  <h4 id="node-modal-title" style="margin:0; font-weight:600;">Nodes</h4>
                  <span id="node-modal-count" class="label label-primary" style="display:none"></span>
                </div>
                <div style="display:flex; gap:6px; flex-wrap:wrap; align-items:center;">
                  <input id="node-filter" type="text" class="form-control input-sm" placeholder="Filter (name, ip, device)" style="width:220px;">
                  <button id="node-copy" type="button" class="btn btn-xs btn-default" title="Copy visible nodes"><span class="glyphicon glyphicon-copy" aria-hidden="true"></span></button>
                  <button id="node-modal-close" type="button" class="btn btn-xs btn-default">Close</button>
                </div>
              </div>
              <div style="border:1px solid #ddd; border-radius:4px; max-height:420px; overflow:auto;">
                <table id="node-modal-table" class="table table-condensed table-striped" style="margin:0; font-size:12px;">
                  <thead style="position:sticky; top:0; background:#fafafa;">
                    <tr>
                      <th style="width:18%; cursor:pointer;" data-key="ip">IP / Net <span class="glyphicon glyphicon-sort" aria-hidden="true"></span></th>
                      <th style="width:16%; cursor:pointer;" data-key="n">Name <span class="glyphicon glyphicon-sort" aria-hidden="true"></span></th>
                      <th style="width:8%; cursor:pointer;" data-key="i">ID <span class="glyphicon glyphicon-sort" aria-hidden="true"></span></th>
                      <th style="width:14%; cursor:pointer;" data-key="d">Device <span class="glyphicon glyphicon-sort" aria-hidden="true"></span></th>
                      <th style="width:14%; cursor:pointer;" data-key="h">Host <span class="glyphicon glyphicon-sort" aria-hidden="true"></span></th>
                      <th style="width:14%; cursor:pointer;" data-key="m">Master <span class="glyphicon glyphicon-sort" aria-hidden="true"></span></th>
                      <th style="width:16%;">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="node-modal-tbody"><tr><td colspan="6" class="text-muted">Loading...</td></tr></tbody>
                </table>
              </div>
              <div style="margin-top:8px; font-size:11px; color:#666; display:flex; justify-content:space-between; flex-wrap:wrap; gap:8px;">
                <div>Filter supports simple substring match.</div>
                <div></div>
              </div>
              <pre id="node-modal-body" style="display:none; margin-top:10px; font-family:monospace; font-size:11px; max-height:320px; overflow:auto; background:#fcfcfc; border:1px solid #eee; padding:8px;"></pre>
            </div>
          </div>
              <!-- Fetch debug modal -->
              <div id="fetch-debug-modal" class="modal-overlay" aria-hidden="true">
                <div class="modal-panel modal-panel-sm">
                  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
                    <h4 style="margin:0;">Fetch Queue Debug</h4>
                    <div style="display:flex; gap:8px; align-items:center;"><button id="fetch-debug-close" class="btn btn-xs btn-default">Close</button></div>
                  </div>
                    <div class="modal-body-scroll">
                    <pre id="fetch-debug-body" class="modal-pre">Loading...</pre>
                  </div>
                </div>
              </div>

        <!-- Versions -->
        <div id="tab-versions" class="tab-pane">
          <h3>Versions <button id="refresh-versions" class="btn btn-xs btn-default"><span class="spin" id="refresh-versions-spinner"></span>Refresh</button>
            <span id="versions-status" class="small-muted"></span></h3>
          <div id="versions-wrap"></div>
        </div>

  <!-- Raw JSON tab removed -->

        <!-- Traceroute -->
        <div id="tab-traceroute" class="tab-pane">
          <h3>Traceroute</h3>
          <div class="form-inline" style="margin-bottom:8px">
            <input id="tr-host" class="form-control input-sm" placeholder="host or ip" style="width:320px">
            <button id="tr-run" class="btn btn-sm btn-primary">Run</button>
          </div>
          <pre id="p-traceroute" style="display:none;">Traceroute output will appear here</pre>
          <div class="table-search-container"><input class="table-search-input form-control input-sm" data-target="#tracerouteTable" placeholder="Search..."></div>
          <div class="table-responsive" style="margin-top:8px">
            <table id="tracerouteTable" class="table table-condensed table-striped">
              <thead>
                <tr><th>#</th><th>IP</th><th>Hostname</th><th>Ping</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- OLSR2 (populated when available) -->
        <div id="tab-olsr2" class="tab-pane">
          <h3>OLSR2</h3>
          <pre id="olsr2info"></pre>
        </div>

        <!-- Admin (link only) -->
        <div id="tab-admin" class="tab-pane">
          <h3>Admin</h3>
          <p><a id="adminLink" href="#" target="_blank">Login</a></p>
        </div>

          </div>
        </main>
      </div>

      <!-- Toast for critical fetch queue alerts -->
      <div id="fetch-toast" style="display:none; position:fixed; right:18px; bottom:18px; z-index:2500;">
        <div id="fetch-toast-body" style="background:#b94a48; color:#fff; padding:12px 16px; border-radius:6px; box-shadow:0 8px 20px rgba(0,0,0,0.3);">
          <strong>Fetch queue critical</strong>
          <div id="fetch-toast-msg" style="font-size:12px; margin-top:6px;"></div>
        </div>
      </div>

      <!-- Small transient toast for actions (refresh success/error) -->
      <div id="action-toast" style="display:none; position:fixed; right:18px; bottom:86px; z-index:2500;">
        <div id="action-toast-body" style="background:#333; color:#fff; padding:8px 12px; border-radius:6px; box-shadow:0 6px 16px rgba(0,0,0,0.25);">Action</div>
      </div>

      <footer style="margin-top:20px" class="small-muted">Served by olsrd-status-plugin</footer>
    </div>

    <!-- jQuery + Bootstrap JS (CDN) -->
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js"></script>
    <!-- App JS -->
    <script src="/js/app.js"></script>
  </body>
</html>

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Web Status</title>
    <!-- Bootstrap CSS (CDN) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css">
    <style>
  body { padding: 20px; font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; }
  .tab-pane { display: none; }
  .tab-pane.active { display: block; }
  pre { background:#f8f8f8; padding:10px; border:1px solid #ddd; }
  .small-muted { font-size:90%; color:#666; }
  .dl-horizontal dt { width:200px; }
  .page-header h1 { margin-bottom:6px; }
  .table-condensed th, .table-condensed td { padding:6px; }
  .table-hover > tbody > tr:hover { background-color:#f5f5f5; }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="page-header">
        <h1 id="hostname">Hostname</h1>
        <p class="small-muted">IP: <span id="ip"></span> &nbsp; Uptime: <span id="uptime"></span></p>
      </div>

      <!-- Tabs (matching bmk-webstatus.py ordering and labels) -->
      <ul id="mainTabs" class="nav nav-tabs">
        <li role="presentation"><a href="#tab-main"><span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> Übersicht</a></li>
        <li role="presentation" class="active"><a href="#tab-status"><span class="glyphicon glyphicon-dashboard" aria-hidden="true"></span> Status</a></li>
        <li role="presentation"><a href="#tab-olsr"><span class="glyphicon glyphicon-random" aria-hidden="true"></span> OLSR Links</a></li>
  <li role="presentation" id="tab-olsrd2-links" style="display:none"><a href="#tab-neighbors"><span class="glyphicon glyphicon-link" aria-hidden="true"></span> OLSRd2-Links</a></li>
        <li role="presentation"><a href="#tab-connections"><span class="glyphicon glyphicon-transfer" aria-hidden="true"></span> Connections</a></li>
        <li role="presentation"><a href="#tab-versions"><span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span> Versions</a></li>
        <li role="presentation"><a href="#tab-traceroute"><span class="glyphicon glyphicon-road" aria-hidden="true"></span> Traceroute</a></li>
        <li role="presentation"><a href="#tab-json"><span class="glyphicon glyphicon-file" aria-hidden="true"></span> Raw JSON</a></li>
        <li role="presentation" id="tab-olsr2-link" style="display:none"><a href="#tab-olsr2"><span class="glyphicon glyphicon-dashboard" aria-hidden="true"></span> OLSRv2</a></li>
        <li role="presentation"><a href="#tab-contact"><span class="glyphicon glyphicon-user" aria-hidden="true"></span> Kontakt</a></li>
        <li role="presentation" id="tab-admin-link" style="display:none"><a href="#tab-admin"><span class="glyphicon glyphicon-lock" aria-hidden="true"></span> Admin</a></li>
        <li id="nav-host" style="float:right; padding:8px 12px;"></li>
        <li id="nav-login" style="float:right; display:none; padding:6px 12px;"><a id="nav-login-link" href="#" target="_blank"><span class="glyphicon glyphicon-user" aria-hidden="true"></span> Login</a></li>
      </ul>

      <div class="tab-content" style="margin-top:15px">
        <!-- Status -->
        <div id="tab-status" class="tab-pane active">
          <dl class="dl-horizontal">
            <dt>System Uptime <span class="glyphicon glyphicon-time" aria-hidden="true"></span></dt>
            <dd><span id="dl-uptime">-</span></dd>
            <dt>IPv4 Default-Route <span class="glyphicon glyphicon-transfer" aria-hidden="true"></span></dt>
            <dd><span id="dl-default-route"><span id="default-route">n/a</span></span></dd>
            <dt>mgmt Devices <span class="glyphicon glyphicon-signal" aria-hidden="true"></span></dt>
            <dd>&nbsp;</dd>
          </dl>
          <div class="table-responsive">
            <table id="devicesTable" class="table table-hover table-bordered table-condensed">
              <thead>
                <tr>
                  <th>Local (IP / HW)</th>
                  <th>Hostname</th>
                  <th>Product</th>
                  <th>Uptime</th>
                  <th>Mode</th>
                  <th>ESSID</th>
                  <th>Firmware</th>
                  <th>Signal</th>
                  <th>Tx Rate</th>
                  <th>Rx Rate</th>
                  <th>Wireless</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Main / Willkommen -->
        <div id="tab-main" class="tab-pane">
          <div class="page-header">
            <h1>Willkommen auf <span id="main-host"> </span></h1>
          </div>
          <div class="panel panel-default">
            <div class="panel-body"><b>WAS?</b></div>
            <div class="panel-footer">FunkFeuer ist ein freies, experimentelles Netzwerk in Wien, Graz, der Weststeiermark, in Teilen des Weinviertels (N&Ouml;) und in Bad Ischl. Es wird aufgebaut und betrieben von computerbegeisterten Menschen. Das Projekt verfolgt keine kommerziellen Interessen.</div>
          </div>
          <div class="panel panel-default">
            <div class="panel-body"><b>FREI?</b></div>
            <div class="panel-footer">FunkFeuer ist offen f&uuml;r jeden und jede, der/die Interesse hat und bereit ist mitzuarbeiten. Es soll dabei ein nicht reguliertes Netzwerk entstehen, welches das Potential hat, den digitalen Graben zwischen den sozialen Schichten zu &Uuml;berbr&uuml;cken und so Infrastruktur und Wissen zur Verf&uuml;gung zu stellen. Zur Teilnahme an FunkFeuer braucht man einen WLAN Router (gibt's ab 60 Euro) oder einen PC, das OLSR Programm, eine IP Adresse von FunkFeuer, etwas Geduld und Motivation. Auf unserer Karte ist eingezeichnet, wo man FunkFeuer schon &Uuml;berall (ungef&auml;r) empfangen kann (bitte beachte, dass manchmal H&auml;user oder &Auml;hnliches im Weg sind, dann geht's nur &uuml;ber Umwege).</div>
          </div>
        </div>

        <!-- Contact -->
        <div id="tab-contact" class="tab-pane">
          <h3>Kontakt</h3>
          <p>Kontaktinformationen...</p>
        </div>

        <!-- OLSR Links -->
    <div id="tab-olsr" class="tab-pane">
          <h3>OLSR Links</h3>
          <div class="table-responsive">
            <table id="olsrLinksTable" class="table table-bordered table-condensed">
              <thead>
                <tr>
                  <th>Intf</th>
                  <th>Local</th>
                  <th>Remote</th>
                  <th>Remote Host</th>
                  <th>LQ</th>
                  <th>NLQ</th>
                  <th>Cost</th>
                  <th>Routes</th>
                  <th>Nodes</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Neighbors -->
        <div id="tab-neighbors" class="tab-pane">
          <h3>Neighbors</h3>
          <div class="table-responsive">
            <table id="neighborsTable" class="table table-bordered table-condensed">
              <thead>
                <tr>
                  <th>Originator</th>
                  <th>Hostname</th>
                  <th>BindTo</th>
                  <th>LQ</th>
                  <th>NLQ</th>
                  <th>Cost</th>
                  <th>Metric</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Connections -->
        <div id="tab-connections" class="tab-pane">
          <h3>Connections <button id="refresh-connections" class="btn btn-xs btn-default">Refresh</button>
            <span id="connections-status" class="small-muted"></span></h3>
          <div class="table-responsive">
            <table id="connectionsTable" class="table table-condensed table-striped">
              <thead>
                <tr>
                  <th data-key="port">Port</th>
                  <th data-key="bridge">Bridge</th>
                  <th data-key="macs">MACs</th>
                  <th data-key="ips">IPs</th>
                  <th data-key="hostnames">Hostnames</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- Simple Modal for Route Details -->
        <div id="route-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.55); z-index:2000; overflow:auto;">
          <div style="background:#fff; margin:50px auto; padding:18px 22px 20px; max-width:900px; border:1px solid #bbb; border-radius:6px; box-shadow:0 8px 24px rgba(0,0,0,0.25);">
            <div style="display:flex; flex-wrap:wrap; gap:10px; justify-content:space-between; align-items:center; margin-bottom:10px;">
              <div style="display:flex; align-items:center; gap:12px;">
                <h4 id="route-modal-title" style="margin:0; font-weight:600;">Routes</h4>
                <span id="route-modal-count" class="label label-primary" style="display:none"></span>
              </div>
              <div style="display:flex; gap:6px; flex-wrap:wrap; align-items:center;">
                <input id="route-filter" type="text" class="form-control input-sm" placeholder="Filter (prefix, dev, metric)" style="width:220px;">
                <button id="route-copy" type="button" class="btn btn-xs btn-default" title="Copy visible routes"><span class="glyphicon glyphicon-copy" aria-hidden="true"></span></button>
                <button id="route-modal-close" type="button" class="btn btn-xs btn-default">Close</button>
              </div>
            </div>
            <div style="border:1px solid #ddd; border-radius:4px; max-height:420px; overflow:auto;">
              <table id="route-modal-table" class="table table-condensed table-striped" style="margin:0; font-size:12px;">
                <thead style="position:sticky; top:0; background:#fafafa;">
                  <tr>
                    <th style="width:45%;">Destination</th>
                    <th style="width:20%;">Device</th>
                    <th style="width:15%;">Metric</th>
                    <th style="width:20%;">Raw</th>
                  </tr>
                </thead>
                <tbody id="route-modal-tbody"><tr><td colspan="4" class="text-muted">Loading...</td></tr></tbody>
              </table>
            </div>
            <div style="margin-top:8px; font-size:11px; color:#666; display:flex; justify-content:space-between; flex-wrap:wrap; gap:8px;">
              <div>Click a column header to sort (coming soon) • Filter supports simple substring match.</div>
              <div><button id="route-raw-toggle" class="btn btn-link btn-xs" style="padding:0">Show raw text</button></div>
            </div>
            <pre id="route-modal-body" style="display:none; margin-top:10px; font-family:monospace; font-size:11px; max-height:320px; overflow:auto; background:#fcfcfc; border:1px solid #eee; padding:8px;"></pre>
          </div>
        </div>

          <!-- Simple Modal for Node Details -->
          <div id="node-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.55); z-index:2000; overflow:auto;">
            <div style="background:#fff; margin:50px auto; padding:18px 22px 20px; max-width:900px; border:1px solid #bbb; border-radius:6px; box-shadow:0 8px 24px rgba(0,0,0,0.25);">
              <div style="display:flex; flex-wrap:wrap; gap:10px; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <div style="display:flex; align-items:center; gap:12px;">
                  <h4 id="node-modal-title" style="margin:0; font-weight:600;">Nodes</h4>
                  <span id="node-modal-count" class="label label-primary" style="display:none"></span>
                </div>
                <div style="display:flex; gap:6px; flex-wrap:wrap; align-items:center;">
                  <input id="node-filter" type="text" class="form-control input-sm" placeholder="Filter (name, ip, device)" style="width:220px;">
                  <button id="node-copy" type="button" class="btn btn-xs btn-default" title="Copy visible nodes"><span class="glyphicon glyphicon-copy" aria-hidden="true"></span></button>
                  <button id="node-modal-close" type="button" class="btn btn-xs btn-default">Close</button>
                </div>
              </div>
              <div style="border:1px solid #ddd; border-radius:4px; max-height:420px; overflow:auto;">
                <table id="node-modal-table" class="table table-condensed table-striped" style="margin:0; font-size:12px;">
                  <thead style="position:sticky; top:0; background:#fafafa;">
                    <tr>
                      <th style="width:25%;">IP / Net</th>
                      <th style="width:20%;">Name</th>
                      <th style="width:10%;">ID</th>
                      <th style="width:15%;">Device</th>
                      <th style="width:15%;">Host</th>
                      <th style="width:15%;">Master</th>
                    </tr>
                  </thead>
                  <tbody id="node-modal-tbody"><tr><td colspan="6" class="text-muted">Loading...</td></tr></tbody>
                </table>
              </div>
              <div style="margin-top:8px; font-size:11px; color:#666; display:flex; justify-content:space-between; flex-wrap:wrap; gap:8px;">
                <div>Filter supports simple substring match. • Click a row for raw JSON (coming soon)</div>
                <div><button id="node-raw-toggle" class="btn btn-link btn-xs" style="padding:0">Show raw text</button></div>
              </div>
              <pre id="node-modal-body" style="display:none; margin-top:10px; font-family:monospace; font-size:11px; max-height:320px; overflow:auto; background:#fcfcfc; border:1px solid #eee; padding:8px;"></pre>
            </div>
          </div>

        <!-- Versions -->
        <div id="tab-versions" class="tab-pane">
          <h3>Versions <button id="refresh-versions" class="btn btn-xs btn-default">Refresh</button>
            <span id="versions-status" class="small-muted"></span></h3>
          <div id="versions-wrap"></div>
        </div>

        <!-- Raw JSON -->
        <div id="tab-json" class="tab-pane">
          <h3>Raw JSON</h3>
          <pre id="p-json">Loading…</pre>
        </div>

        <!-- Traceroute -->
        <div id="tab-traceroute" class="tab-pane">
          <h3>Traceroute</h3>
          <div class="form-inline" style="margin-bottom:8px">
            <input id="tr-host" class="form-control input-sm" placeholder="host or ip" style="width:320px">
            <button id="tr-run" class="btn btn-sm btn-primary">Run</button>
          </div>
          <pre id="p-traceroute" style="display:none;">Traceroute output will appear here</pre>
          <div class="table-responsive" style="margin-top:8px">
            <table id="tracerouteTable" class="table table-condensed table-striped">
              <thead>
                <tr><th>#</th><th>IP</th><th>Hostname</th><th>Ping</th></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <!-- OLSR2 (populated when available) -->
        <div id="tab-olsr2" class="tab-pane">
          <h3>OLSR2</h3>
          <pre id="olsr2info"></pre>
        </div>

        <!-- Admin (link only) -->
        <div id="tab-admin" class="tab-pane">
          <h3>Admin</h3>
          <p><a id="adminLink" href="#" target="_blank">Login</a></p>
        </div>

      </div>

      <footer style="margin-top:20px" class="small-muted">Served by olsrd-status-plugin</footer>
    </div>

    <!-- jQuery + Bootstrap JS (CDN) -->
    <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/js/bootstrap.min.js"></script>
    <!-- App JS -->
    <script src="/js/app.js"></script>
  </body>
</html>
